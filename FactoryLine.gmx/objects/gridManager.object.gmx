<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>1</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Define grid size

var s = 32;
width = s;
height = s;
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Create the grid

grid = ds_grid_create(
    ceil( room_width / width ),
    ceil( room_height / height )
);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="1" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Remove the grid

ds_grid_destroy( grid );
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="2">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Reset the grid

ds_grid_clear( grid, noone );
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Include all blocks

var tGrid = grid;

with ( block ) {
    if ( !gridValidPoint( x, y ) ) continue;
    var cx = gridFromRoomX( x );
    var cy = gridFromRoomY( y );
    ds_grid_set( tGrid, cx, cy, id );
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Check for item collisions

var tGrid = grid;
var tWidth = width/2;
var tHeight = height/2;

with ( item ) {
    if ( !gridValidPoint( x, y ) ) continue;
    
    //Push out of any nearby blocks
    //Check this cell, and any adjacent cell
    var cx = min( gridFromRoomX( x ) + 2, ds_grid_width( tGrid ) );
    var cy = min( gridFromRoomY( y ) + 2, ds_grid_height( tGrid ) );
    for ( var i = max( cx-3, 0 ); i &lt; cx; ++i ) {
        for ( var j = max( cy-3, 0 ); j &lt; cy; ++j ) {
            var tInst = ds_grid_get( tGrid, i, j );
            if ( !instance_exists( tInst ) ) continue;
            if ( !isObject( tInst, block ) ) continue;
            var tCellX = gridToRoomX( i );
            var tCellY = gridToRoomY( j );
            if ( rectangle_in_rectangle(
                tCellX-tWidth, tCellY-tHeight, tCellX+tWidth, tCellY+tHeight,
                x-width/2, y-height/2, x+width/2, y+height/2 ) )
            {
                if ( abs( y - tCellY ) &lt; abs( x - tCellX ) ) {
                    var tDir = sign( x - tCellX );
                    hspeed = ( max( tDir * hspeed, 0 ) * tDir );
                    x = ( tCellX + tDir * ( tWidth + width/2 ) );
                } else {
                    var tDir = sign( y - tCellY );
                    vspeed = ( max( tDir * vspeed, 0 ) * tDir );
                    y = ( tCellY + tDir * ( tHeight + height/2 ) );
                }
            }
        }
    }
    
    //Check for collisions with items
    var tInst = ds_grid_get( tGrid, cx, cy );
    if ( instance_exists( tInst ) ) {
        if ( isObject( tInst, item ) ) {
            //Eww...
        }
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Draw gridlines

draw_set_color( c_white );
draw_set_alpha( 1 );

draw_primitive_begin( pr_linelist );

for ( var i = 0; i &lt; ds_grid_width( grid ); ++i ) {
    draw_vertex( i * width, 0 );
    draw_vertex( i * width, room_height );
}

for ( var j = 0; j &lt; ds_grid_height( grid ); ++j ) {
    draw_vertex( 0, j * height );
    draw_vertex( room_width, j * height );
}

draw_primitive_end( );

draw_set_color( c_white );
draw_set_alpha( 1 );
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Fill in object grid cells

draw_set_color( c_white );
draw_set_alpha( 1 );

for ( var i = 0; i &lt; ds_grid_width( grid ); ++i ) {
    for ( var j = 0; j &lt; ds_grid_height( grid ); ++j ) {
        var tInst = ds_grid_get( grid, i, j );
        if ( instance_exists( tInst ) ) {
            var px = gridToRoomX( i );
            var py = gridToRoomY( j );
            if ( isObject( tInst, block ) ) {
                draw_set_color( c_aqua );
            } else if ( isObject( tInst, item ) ) {
                draw_set_color( c_lime );
            } else {
                draw_set_color( c_red );
            }
            draw_rectangle( px-width/2, py-height/2,
                px+width/2, py+height/2, false );
        }
    }
}

draw_set_color( c_white );
draw_set_alpha( 1 );
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
